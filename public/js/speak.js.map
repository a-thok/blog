{"version":3,"sources":["speak.js"],"names":["const","$","selector","context","document","querySelector","window","readBtn","removeAttribute","articleText","textContent","changeBtnText","text","utterance","SpeechSynthesisUtterance","rate","lang","addEventListener","speechSynthesis","paused","resume","speaking","pause","speak","cancel"],"mappings":"AAAAA,GAAOC,GAAG,SAAAC,EAACC,yBAAUC,UAAOD,EAAAE,cAAAH,GAG5B,IAAI,mBAHgDI,QAAc,CAAUN,GAAAO,SAAAN,EAAA,iBAK1EM,SAAQC,gBAAgB,SAF1BR,IAAIS,aAAiBR,EAAA,oBAAYS,YACzBC,cAAY,SAAAC,GAAkBL,QAAAG,YAAAE,GAM9BC,UAAY,GAAIC,yBAHtBd,WAAMY,KAAWH,YACjBT,UAAMe,KAAa,IAKnBF,UAAUG,KAAO,QAFjBH,UAAUI,iBAAO,QAAY,WAAA,MAAAN,eAAA,UAC7BE,UAAUI,iBAAY,QAAA,WAAA,MAAAN,eAAA,UACtBE,UAAUI,iBAAe,SAAA,WAAA,MAAAN,eAAA,UAKzBE,UAAUI,iBAAiB,MAAO,WAAG,MAAGN,eAAc,UA6DtDJ,QAAQU,iBAAiB,QAAS,WAC5BC,gBAAgBC,OAClBD,gBAAgBE,SACPF,gBAAgBG,SAH7BH,gBAAQI,SAEJf,QAAAG,YAAsB,SACvBQ,gBAAUK,MAAAV,cAUbP,OAJGW,iBAAA,eAAA,WAKDC,gBAAgBM","file":"speak.js","sourcesContent":["const $ = (selector, context = document) => context.querySelector(selector);\r\n\r\n\r\nif ('speechSynthesis' in window) {\r\n  const readBtn = $('.article-speak');\r\n  readBtn.removeAttribute('hidden');\r\n\r\n  const articleText = $('.article-content').textContent;\r\n  const changeBtnText = (text) => { readBtn.textContent = text; };\r\n\r\n  const utterance = new SpeechSynthesisUtterance();\r\n  utterance.text = articleText;\r\n  utterance.rate = 0.95;\r\n  utterance.lang = 'zh-CN';\r\n\r\n  utterance.addEventListener('start', () => changeBtnText('暂停朗读'));\r\n  utterance.addEventListener('pause', () => changeBtnText('继续朗读'));\r\n  utterance.addEventListener('resume', () => changeBtnText('暂停朗读'));\r\n  utterance.addEventListener('end', () => changeBtnText('重新朗读'));\r\n\r\n  // const changeVoice = (voice) => {\r\n  //   if (speechSynthesis.speaking) {\r\n  //     speechSynthesis.cancel();\r\n  //     utterance.voice = voice;\r\n  //     setTimeout(() => {\r\n  //       changeBtnText('处理中...');\r\n  //       speechSynthesis.speak(utterance);\r\n  //     });\r\n  //   } else {\r\n  //     utterance.voice = voice;\r\n  //   }\r\n  // };\r\n\r\n  // const createVoiceSelect = (voices) => {\r\n  //   const docFragment = document.createDocumentFragment();\r\n\r\n  //   const label = document.createElement('label');\r\n  //   label.textContent = '声音：';\r\n\r\n  //   const select = document.createElement('select');\r\n  //   select.classList.add('form');\r\n\r\n  //   voices.forEach((voice, index) => {\r\n  //     const option = document.createElement('option');\r\n  //     option.textContent = voice.name.replace(/(.*)\\s-\\s.*/, '$1');\r\n  //     option.value = index;\r\n  //     select.appendChild(option);\r\n  //   });\r\n\r\n  //   docFragment.appendChild(label);\r\n  //   docFragment.appendChild(select);\r\n\r\n  //   articleRead.insertBefore(docFragment, readBtn);\r\n\r\n  //   return select;\r\n  // };\r\n\r\n  // let voices;\r\n  // voices = speechSynthesis.getVoices();\r\n  // if (voices.length) {\r\n  //   const select = createVoiceSelect(voices);\r\n  //   select.addEventListener('change', (event) => {\r\n  //     const voice = voices[event.target];\r\n  //     changeVoice(voice);\r\n  //   });\r\n  // } else {\r\n  //   speechSynthesis.addEventListener('voiceschanged', () => {\r\n  //     voices = speechSynthesis.getVoices();\r\n  //     if (voices.length) {\r\n  //       const select = createVoiceSelect(voices);\r\n  //       select.addEventListener('change', (event) => {\r\n  //         const voice = voices[event.target];\r\n  //         changeVoice(voice);\r\n  //       });\r\n  //     }\r\n  //   });\r\n  // }\r\n\r\n  // reading control\r\n  readBtn.addEventListener('click', () => {\r\n    if (speechSynthesis.paused) {\r\n      speechSynthesis.resume();\r\n    } else if (speechSynthesis.speaking) {\r\n      speechSynthesis.pause();\r\n    } else {\r\n      readBtn.textContent = '处理中...';\r\n      speechSynthesis.speak(utterance);\r\n    }\r\n  });\r\n\r\n  // don't know why, but the speech might continue dispite the page being refreshed or closed\r\n  // so I've to cancel it manually\r\n  window.addEventListener('beforeunload', () => {\r\n    speechSynthesis.cancel();\r\n  });\r\n}\r\n"]}